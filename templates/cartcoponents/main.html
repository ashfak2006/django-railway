{% load static %}
{% load gettotal %}
{% load gettax %}

<main class="flex-grow container mx-auto mt-12 px-4 py-8">
    <h1 class="text-lg font-bold text-gray-900 mb-6">Shopping Cart ({{cart.order_items.count}} items)</h1>

    <!-- Promotional Banner -->
     {% for messages in messages %}
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
        <div class="flex flex-col">
            <!-- <p class="text-gray-800 font-medium mb-2">Spend $50 more for free shipping!</p>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                <div class="bg-primary h-2.5 rounded-full" style="width: 65%"></div>
            </div> -->
            <!-- <p class="text-sm text-gray-600">You're $50 away from free shipping</p> -->
            
            <p class="text-lg text-gray-600">{{messages}}</p>
           
        </div>
    </div> 
    {% endfor %}
{% if cart.order_items %}
    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Cart Items -->
        <div class="lg:w-2/3  bg-white rounded-lg shadow-sm p-6">
            <div class="space-y-6">


                <!-- Cart Item 1 -->
               
                 {% for objects in cart.order_items.all %}
                <div class="flex border border-gray-300 rounded-lg overflow-hidden items-center py-4 px-4 ">
                    <div class="w-20 h-20 flex-shrink-0 bg-gray-50 rounded overflow-hidden">
                        <img src="{{objects.product.image1.url}}" alt="Wireless Headphones" class="w-full h-full object-cover object-top">
                    </div>
                    <div class="ml-4 flex-grow">
                        <h3 class="text-gray-800 font-medium">{{objects.product.title}}</h3>
                        <p class="text-gray-500 text-sm">{{objects.product.catogaris.name}}</p>
                    </div>
                    <div class="flex items-center ml-4">
                        <div class="flex items-center border border-gray-200 rounded">
                            <button class="w-8 h-8 flex items-center justify-center text-gray-600 hover:bg-gray-50 !rounded-button" onclick="updateQuantity('item1', -1)">
                                <i class="ri-subtract-line"></i>
                            </button>
                            <input type="number" id="item1-qty" class="quantity-input w-10 h-8 text-center border-none focus:outline-none text-gray-700" value="{{objects.quantity}}" min="{{objects.quantity}}" max="{{objects.quantity}}">
                            <button class="w-8 h-8 flex items-center justify-center text-gray-600 hover:bg-gray-50 !rounded-button" onclick="updateQuantity('item1', 1)">
                                <i class="ri-add-line"></i>
                            </button>
                        </div>
                    </div>
                    <div class="ml-6 text-right">
                        <p class="text-gray-900 font-medium">${{objects.total_price}}</p>
                    </div>
                    <button class="ml-4 w-8 h-8 flex items-center justify-center text-gray-400 hover:text-red-500">
                        <a href="{% url 'remove_item' objects.id %}"><i class="ri-delete-bin-line"></i></a>
                    </button>
                </div>
                {% endfor %}

                
            </div>

            <div class="mt-8">
                <a href="{% url 'products_list1' %}" class="inline-flex items-center text-primary hover:underline">
                    <i class="ri-arrow-left-line mr-2"></i>
                    Continue Shopping
                </a>
            </div>
        </div>

        <!-- Order Summary -->
         
        <div class="lg:w-1/3">
            <div class="bg-white rounded-lg shadow-sm p-6 sticky top-4">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Order Summary</h2>
                
                <div class="space-y-3 mb-6">
                    <div class="flex justify-between">
                        <span class="text-gray-600">price ( {{cart.order_items.count}} items)</span> 
                        <span class="text-gray-900 font-medium">${{cart.total_amount}}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Shipping</span>
                        {% if cart.shipping.is_free %}
                        <span class="text-green-900 font-medium">Free</span>
                        {% else %}
                        <span class="text-gray-900 font-medium">${{ship}}</span>
                        {% endif %}
                    </div>
                   
                    <div class="border-t border-gray-200 pt-3 mt-3">
                        <div class="flex justify-between">
                            <span class="text-gray-900 font-semibold">Total</span>
                            <span class="text-gray-900 font-semibold text-xl">${{cart.grand_total}}</span>
                        </div>
                    </div>
                </div>
             

                <div class="space-y-4">
                    {% if cart.promocode %}
                    <div class="relative">
                    <a href="{% url 'remove_discount' %}" > 
                        <input type="text" value="{{cart.promocode}}"  placeholder="Promo Code" class="w-full px-4 py-3 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <button class="absolute  right-2 top-1/2 transform -translate-y-1/2 px-3 py-1 bg-primary text-white text-sm rounded !rounded-button whitespace-nowrap">
                            remove
                        </button>
                    </a>
                     </div>
                    {% else %}
                <form  method="post" enctype="multipart/form-data" action="{% url 'apply_discount' %}">
                        {% csrf_token %}
                    <div class="relative">
                        <input type="text" name="promocode" placeholder="Promo Code" class="w-full px-4 py-3 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <button type="submit" name="Discount"  class="absolute right-2 top-1/2 transform -translate-y-1/2 px-3 py-1 bg-primary text-white text-sm rounded !rounded-button whitespace-nowrap">
                            Apply
                        </button>
                    </div> 
                    {% endif %}
                </form>
            
                
                    <a href="{% url 'check_out' %}">
                    <button type="submit" nam="check_out" class="w-full bg-primary mt-4 hover:bg-primary/90 text-white py-4 rounded font-medium !rounded-button whitespace-nowrap">
                       Proceed to Checkout
                    </button></a></form>
                    <div class="flex items-center justify-center space-x-4 mt-4">
                        <div class="w-8 h-8 flex items-center justify-center">
                            <i class="ri-visa-fill text-blue-900 text-xl"></i>
                        </div>
                        <div class="w-8 h-8 flex items-center justify-center">
                            <i class="ri-mastercard-fill text-orange-600 text-xl"></i>
                        </div>
                        <div class="w-8 h-8 flex items-center justify-center">
                            <i class="ri-paypal-fill text-blue-700 text-xl"></i>
                        </div>
                        <div class="w-8 h-8 flex items-center justify-center">
                            <i class="ri-apple-fill text-gray-800 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
{% else %}
        <div class="bg-red-50  border border-red-200 rounded-lg p-4 mt-6">
        <div class="flex flex-col text-center">
            <a href="{% url 'products_list1' %}">
            <p class="text-lg text-gray-600">add items in your Cart</p></a>
        </div>
    </div>
{% endif %}
</main>